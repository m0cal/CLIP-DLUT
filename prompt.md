**任务目标：**
请基于 `CLIP-DLUT` 项目现有的后端 API 架构，构建一个极具设计感的 Gradio 前端页面。

**1. 核心开发原则：直接复用逻辑**

* **严禁手写图像处理函数：** 不要编写 `apply_lut`、`process_image` 等本地处理逻辑。前端必须通过 `requests` 严格调用后端的 `/retouch` 和 `/query_task` 接口。
* **复用后端协议：** 直接透传用户输入的 `image` (Base64)、`target_prompt`、`original_prompt` 和 `iteration` 到后端 Celery 任务流中。
* **异步轮询机制：** 必须使用 Python 的 `time.sleep` 或 Gradio 的 `gr.Timer`（如果适用）来实现对 `/query_task` 的轮询，直到后端返回 `finished` 状态并提供结果图片和 `.cube` 数据的 Base64。

**2. 视觉还原要求（Apple/Linear 极简美学）：**

* **UI 风格：** 参考 Apple 官网和 Linear.app 的设计语言。
* **色彩：** 纯黑背景 (`#000000`)，卡片使用深灰色微透效果 (`#161617`)，强调色使用旧金山蓝色 (`#007AFF`)。
* **字体与质感：** 文本使用 Sans-serif 字体；所有容器应用 `rounded-3xl` 大圆角、`backdrop-blur-xl` 毛玻璃效果以及极细的 `ring-1 ring-white/10` 边框。


* **布局规范：** 桌面端固定 1440px 宽度，采用左右非对称布局（3:7）。左侧为控制台，右侧为大尺寸结果展示区。

**3. 前端功能与交互：**

* **顶部状态栏：** 包含项目 Logo "CLIP-DLUT" 和一个**实时 API 连接指示灯**（绿色表示 127.0.0.1:8000 可达）。
* **输入组件：** * 使用 `gr.Image` 作为拖拽上传区，样式需自定义为简约的虚线边框。
* Prompt 输入框需有清晰的 Label 和 Placeholder 引导。


* **输出组件：**
* **结果对比：** 任务完成后，展示处理后的图片，并提供一个“查看原图”的切换按钮或对比滑块。
* **文件导出：** 提供一个带有 `.cube` 图标的下载按钮。注意：直接从后端返回的 Base64 字符串转换成可下载的文件对象，不要在前端重新生成。


* **进度反馈：** 轮询时，在界面显著位置展示动态进度（例如：`Optimizing LUT: 450/1000 iterations`）。

**4. 技术实现规格：**

* **网络鲁棒性：** 在 `requests.Session` 中显式设置 `trust_env=False`，防止 WSL 代理干扰本地通信。
* **CSS 注入：** 通过 `gr.Blocks(css=...)` 注入 Tailwind 风格的 CSS，高度还原磨砂金属和暗黑模式的视觉深度。
* **错误处理：** 如果后端返回 `failed`，需将后端的 `error` 信息以质感优雅的红字 Alert 形式展示。





### 优化后的前端设计方案

1. **UI 风格**：

   * **背景颜色**：使用纯黑色 (`#000000`) 背景，带来暗黑模式的现代感。
   * **卡片设计**：卡片使用深灰色 (`#161617`)，并带有毛玻璃效果（`backdrop-blur-xl`），大圆角（`rounded-3xl`）以及细白边框（`ring-1 ring-white/10`），呈现简约而精致的感觉。
   * **强调色**：使用旧金山蓝色（`#007AFF`）作为按钮、标签和重要内容的高亮色。
   * **字体**：使用 Sans-serif 字体，保持界面清晰和易读。
   * **布局**：固定桌面端宽度为 1440px，采用 3:7 的非对称布局，左侧为控制面板，右侧为结果展示区域。

2. **顶部状态栏**：

   * **Logo**：“CLIP-DLUT” 项目名称的 Logo 放置在左侧，使用简约的无衬线字体。
   * **API 连接指示灯**：在 Logo 旁边显示一个小指示灯，绿色表示 API 可达（`127.0.0.1:8000`）。这个指示灯采用微妙的动画效果，让用户时刻了解连接状态。

3. **输入组件**：

   * **图像上传**：使用 `gr.Image` 组件，并自定义样式，确保上传区域有干净的虚线边框，背景透明感，保持简洁。
   * **Prompt 输入框**：

     * 添加清晰的标签（例如：“目标色调”和“原始描述”），帮助用户明确输入内容。
     * 输入框的 placeholder 提供引导，例如“输入目标色调描述”以及“输入原始图像描述”。
   * **迭代次数滑块**：提供一个优雅的滑块，确保它与整体设计风格一致。滑块旁显示一个精致的数字计数。

4. **输出组件**：

   * **处理后的图像**：任务完成后，将处理后的图像展示在右侧区域，确保图像清晰且显著。

     * 提供“查看原图”按钮或对比滑块，用户可以在处理后图像和原图之间切换，使用平滑的过渡效果（例如滑动或淡入淡出）。
   * **.cube 文件下载**：在图像旁边提供一个下载按钮，带有 `.cube` 文件图标。按钮可用软阴影效果，并在悬停时表现出互动感。

5. **进度反馈**：

   * **实时进度**：在界面显著位置展示动态进度（例如：`Optimizing LUT: 450/1000 iterations`）。确保进度条风格优雅，与整体设计协调一致，使用蓝色（`#007AFF`）作为进度条的颜色。

6. **错误处理**：

   * **错误警告**：如果后端返回 `failed` 状态，应以优雅的红色文字展示错误信息。错误提示框设计为简洁的红色警报框，避免过于突出但仍能清晰传达错误信息。







### 优化后的 Prompt 设计

---

### 1. **支持多种格式的图片下载**

* **目标**：让用户能够选择并下载多种格式的处理图像（如 `.png`, `.jpg`, `.jpeg` 等）。
* **设计**：提供一个下载格式选择器（如下拉框），用户可以选择他们想要的图像格式，下载按钮动态根据选择的格式变化。

### 2. **隐去不必要的英文与技术细节**

* **目标**：界面应保持简洁且符合优雅设计，不展示任何无关的英文、模型内部的技术细节等。
* **设计**：

  * **简洁化的文本**：界面中的所有文本、标签、按钮等应采用中文并清晰明了。
  * **不显示技术细节**：如 API 请求地址、迭代次数、技术参数等，应通过后端进行处理，前端仅展示结果和必要的进度。
  * **隐去错误信息**：当后端出错时，展示优雅的中文错误提示，而不是显示过多的技术细节。

### 3. **进度条优化与预计时间提示**

* **目标**：进度条应具备流动感，并提供预计剩余时间，增强用户体验。
* **设计**：

  * **进度条流动感**：进度条可以做平滑的动态效果，如使用缓动函数（e.g., `ease-in-out`）使其更加自然流畅。
  * **预计时间**：进度条旁边实时显示任务剩余的预计时间（如“剩余 30 秒”），通过后端计算并传递到前端显示。

### 4. **优化界面性能与内存占用**

* **目标**：提高界面的响应速度，减少内存占用和卡顿现象，提升操作流畅性。
* **设计**：

  * **资源优化**：减少不必要的组件渲染，使用 `gr.Blocks()` 中的 `clear_cache=True` 等参数以避免多次渲染时内存占用过高。
  * **异步加载**：大文件或大图片的处理应异步进行，避免阻塞 UI，利用 `gr.Timer` 或 `asyncio` 来实现非阻塞式进度更新。
  * **优化组件渲染**：使用懒加载（lazy loading）或按需加载的方式，避免加载不必要的组件，减轻内存压力。